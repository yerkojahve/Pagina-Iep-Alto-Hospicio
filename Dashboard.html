<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Dashboard - Concentración de Jóvenes IEP Alto Hospicio</title>

  <!-- Bootstrap / Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Estilos propios -->
  <link href="assets/css/dashboard.css" rel="stylesheet" />
</head>

<body>
  <div class="ahj-dashboard">
    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        <aside class="col-md-3 col-lg-2 ahj-sidebar p-3">
          <h4 class="text-center"><i class="fa-solid fa-cross"></i> Admin IEP</h4>
          <nav class="d-grid gap-1">
            <a href="Dashboard.html#panel"><i class="fa-solid fa-house"></i> Panel Principal</a>
            <a href="Dashboard.html#visitantes"><i class="fa-solid fa-users"></i> Visitantes</a>
            <a href="Dashboard.html#hospedajes"><i class="fa-solid fa-house-chimney"></i> Hospedajes</a>
            <a href="Dashboard.html#iglesias"><i class="fa-solid fa-church"></i> Iglesias</a>
            <a href="Dashboard.html#organizadores"><i class="fa-solid fa-user-tie"></i> Organizadores</a>
            <a href="Dashboard.html#evento"><i class="fa-solid fa-calendar-days"></i> Evento</a>

            <!-- ÚNICO enlace a otra página -->
            <a href="https://iepaltohospicio.site/mesas.html"><i class="fa-solid fa-table-cells"></i> Mesas</a>
          </nav>
          <div class="ahj-verse mt-5">
            "Ninguno tenga en poco tu juventud, sino sé ejemplo de los creyentes en palabra, conducta, amor, espíritu,
            fe y pureza."
            <br><small>(1 Timoteo 4:12)</small>
          </div>
        </aside>

        <!-- Main Content -->
        <main class="col-md-9 col-lg-10 ahj-content">
          <!-- Header -->
          <header class="mb-4 pb-2 border-bottom">
            <div class="d-flex justify-content-between align-items-center">
              <h2 class="mb-0">Dashboard — Concentración de Jóvenes</h2>
              <div class="d-flex align-items-center gap-2">
                <input id="buscador" class="form-control d-none d-md-inline-block w-auto" type="search"
                  placeholder="Buscar visitante…" />
                <i class="fa-solid fa-user-circle fa-2x text-secondary d-none d-md-inline-block"></i>
              </div>
            </div>
          </header>

          <!-- ===================== PANEL PRINCIPAL ===================== -->
          <section id="panel" class="mb-5">
            <div class="bg-body-tertiary rounded-3 p-3 p-md-4">
              <div class="d-flex align-items-center justify-content-between mb-3">
                <div class="d-flex align-items-center gap-2">
                  <span class="badge rounded-pill text-bg-primary px-3 py-2"><i class="fa-solid fa-gauge"></i> Panel</span>
                  <h3 class="mb-0">Panel Principal</h3>
                </div>
                <span id="updated_at" class="ahj-small-muted"></span>
              </div>

              <!-- KPIs fila 1 -->
              <div class="row g-3 mb-0">
                <div class="col-6 col-md-3">
                  <div class="card ahj-kpi-card text-center p-3 h-100">
                    <div class="ahj-kpi-title">Visitantes Registrados</div>
                    <div id="kpi_asistentes" class="ahj-kpi-value">—</div>
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="card ahj-kpi-card text-center p-3 h-100">
                    <div class="ahj-kpi-title">Confirmados (asignados)</div>
                    <div id="kpi_confirmados" class="ahj-kpi-value">—</div>
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="card ahj-kpi-card text-center p-3 h-100">
                    <div class="ahj-kpi-title">Familias Hospedadoras</div>
                    <div id="kpi_familias" class="ahj-kpi-value">—</div>
                    <div class="ahj-small-muted">Capacidad total: <span id="kpi_capacidad">—</span></div>
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="card ahj-kpi-card text-center p-3 h-100">
                    <div class="ahj-kpi-title">Cupos libres totales</div>
                    <div id="kpi_cupos" class="ahj-kpi-value">—</div>
                  </div>
                </div>
              </div>

              <!-- KPIs fila 2 -->
              <div class="row g-3 mt-0">
                <div class="col-6 col-md-3">
                  <div class="card ahj-kpi-card text-center p-3 h-100">
                    <div class="ahj-kpi-title">Ocupación total</div>
                    <div id="kpi_ocupacion" class="ahj-kpi-value">—</div>
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="card ahj-kpi-card text-center p-3 h-100">
                    <div class="ahj-kpi-title">Iglesias</div>
                    <div id="kpi_iglesias" class="ahj-kpi-value">—</div>
                  </div>
                </div>
                <div class="col-6 col-md-3">
                  <div class="card ahj-kpi-card text-center p-3 h-100">
                    <div class="ahj-kpi-title">Organizadores</div>
                    <div id="kpi_organizadores" class="ahj-kpi-value">—</div>
                  </div>
                </div>
              </div>

              <!-- Cuenta regresiva -->
              <div class="row g-3 mt-3">
                <div class="col-12">
                  <div class="card p-4 text-center shadow-sm">
                    <h4 class="mb-3"><i class="fa-solid fa-clock"></i> Cuenta regresiva al evento</h4>
                    <p id="countdown" class="display-6 fw-bold text-danger mb-0"></p>
                    <small class="text-muted">Prepárate para el día esperado</small>
                  </div>
                </div>
              </div>

              <!-- Gráfico ocupación familias -->
              <div class="row g-3 mt-3">
                <div class="col-12 col-lg-8 mx-auto">
                  <div class="card p-3 h-100 text-center shadow-sm">
                    <h5 class="mb-2">Ocupación Total Visitas Alojadas</h5>
                    <canvas id="chart_ocupacion" style="max-height:260px;"></canvas>
                    <div class="mt-3">
                      <span class="badge bg-primary">Ocupados</span>
                      <span class="badge bg-danger">Libres</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- ===================== VISITANTES ===================== -->
          <section id="visitantes" class="mb-5">
            <div class="bg-white rounded-3 p-3 p-md-4 border">
              <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
                <div class="d-flex align-items-center gap-2">
                  <span class="badge rounded-pill text-bg-success px-3 py-2"><i class="fa-solid fa-users"></i> Visitantes</span>
                  <h3 class="mb-0">Gestión de Visitantes</h3>
                </div>
                <div class="input-group w-auto">
                  <span class="input-group-text"><i class="fa fa-search"></i></span>
                  <input id="vis-buscar" class="form-control" type="search" placeholder="Buscar por nombre, iglesia, familia o cargo">
                </div>
              </div>
              <small class="ahj-small-muted d-block mb-2">Fuente: personas.json</small>

              <div class="table-responsive">
                <table class="table table-striped align-middle">
                  <thead class="table-dark">
                    <tr>
                      <th>Nombre</th>
                      <th>Iglesia</th>
                      <th>Familia</th>
                      <th>Mesa</th>
                      <th>Cargo</th>
                    </tr>
                  </thead>
                  <tbody id="tbody_personas"></tbody>
                </table>
              </div>

              <div class="d-flex justify-content-between align-items-center mt-2" id="vis-pager-wrap" style="display:none;">
                <small class="text-muted" id="vis-count"></small>
                <nav><ul class="pagination pagination-sm mb-0" id="vis-pager"></ul></nav>
              </div>

              <!-- Gráficos Visitantes -->
              <div class="row g-3 mt-3">
                <div class="col-12 col-lg-8">
                  <div class="card p-3 h-100">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <h5 class="mb-0">Asistentes por iglesia (Top 12)</h5>
                      <small class="text-muted">Conteo de personas</small>
                    </div>
                    <canvas id="chart_iglesias" style="max-height:280px;"></canvas>
                  </div>
                </div>
                <div class="col-12 col-lg-4">
                  <div class="card p-3 h-100">
                    <h5 class="mb-2">Distribución por cargo</h5>
                    <canvas id="chart_cargos" style="max-height:220px;"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- ===================== HOSPEDAJES ===================== -->
          <section id="hospedajes" class="mb-5">
            <div class="bg-body-tertiary rounded-3 p-3 p-md-4">
              <div class="d-flex align-items-center gap-2 mb-3">
                <span class="badge rounded-pill text-bg-warning px-3 py-2"><i class="fa-solid fa-house-chimney"></i> Hospedajes</span>
                <h3 class="mb-0">Gestión de Hospedajes</h3>
              </div>
              <small class="ahj-small-muted d-block mb-2">Fuente: dashboard.json (familias)</small>

              <div class="row g-3 mt-1" id="familias-container"></div>

              <div class="card p-3 mt-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <h5 class="mb-0">Capacidad por familia</h5>
                  <small class="text-muted">Ocupados vs. Disponibles</small>
                </div>
                <canvas id="chart_familias_cap" style="max-height:280px;"></canvas>
              </div>
            </div>
          </section>

          <!-- ===================== IGLESIAS ===================== -->
          <section id="iglesias" class="mb-5">
            <div class="bg-white rounded-3 p-3 p-md-4 border">
              <div class="d-flex align-items-center gap-2 mb-3">
                <span class="badge rounded-pill text-bg-info px-3 py-2"><i class="fa-solid fa-church"></i> Iglesias</span>
                <h3 class="mb-0">Listado de Iglesias</h3>
              </div>
              <small class="ahj-small-muted d-block mb-2">Fuente: full_dump.json</small>

              <div class="table-responsive mt-2">
                <table class="table table-sm align-middle">
                  <thead class="table-light">
                    <tr>
                      <th>Nombre</th>
                      <th>Contacto</th>
                      <th>Teléfono</th>
                      <th>Dirección</th>
                    </tr>
                  </thead>
                  <tbody id="tbody_iglesias"></tbody>
                </table>
              </div>
            </div>
          </section>

          <!-- ===================== ORGANIZADORES ===================== -->
          <section id="organizadores" class="mb-5">
            <div class="bg-body-tertiary rounded-3 p-3 p-md-4">
              <div class="d-flex align-items-center gap-2 mb-3">
                <span class="badge rounded-pill text-bg-secondary px-3 py-2"><i class="fa-solid fa-user-tie"></i> Organizadores</span>
                <h3 class="mb-0">Equipo Organizador</h3>
              </div>
              <small class="ahj-small-muted d-block mb-2">Fuente: full_dump.json</small>

              <div class="table-responsive mt-2">
                <table class="table table-sm align-middle">
                  <thead class="table-light">
                    <tr>
                      <th>Nombre</th>
                      <th>Rol</th>
                      <th>Iglesia</th>
                      <th>Contacto</th>
                      <th>Turno</th>
                    </tr>
                  </thead>
                  <tbody id="tbody_organizadores"></tbody>
                </table>
              </div>
            </div>
          </section>

          <footer class="border-top py-4 text-center text-muted small">
            © 2025 IEP Alto Hospicio.
          </footer>
        </main>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Lógica propia -->
  <script defer src="assets/js/dashboard.js?v=1"></script>
</body>
</html>
